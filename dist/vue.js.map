{"version":3,"file":"vue.js","sources":["../src/compiler/parser.js","../src/compiler/index.js","../src/utils.js","../src/observer/arrary.js","../src/observer/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["const ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*` // 标签名\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})` //  用来获取的标签名的 match后的索引为1的\nconst startTagOpen = new RegExp(`^<${qnameCapture}`) // 匹配开始标签的\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`) // 匹配闭合标签的\n//           aa  =   \"  xxx \"  | '  xxxx '  | xxx\nconst attribute =\n  /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/ // a=b  a=\"b\"  a='b'\nconst startTagClose = /^\\s*(\\/?)>/ //     />   <div/>\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g // {{aaaaa}}\n\nlet root = null\n\nfunction start(tagName, attributes) {\n  console.log('start', tagName, attributes)\n}\n\nfunction end(tagName) {\n  console.log('end', tagName)\n}\nfunction chars(text) {\n  console.log('chars', text)\n}\n\nexport function parserHTML(html) {\n  function advance(len) {\n    html = html.substring(len)\n  }\n\n  function parseStartTag() {\n    const start = html.match(startTagOpen)\n    if (start) {\n      const match = {\n        tagName: start[1],\n        attrs: []\n      }\n      advance(start[0].length)\n      let end\n      // 如果没有遇到标签结尾就不停的解析\n      let attr\n\n      while (\n        !(end = html.match(startTagClose)) &&\n        (attr = html.match(attribute))\n      ) {\n        match.attrs.push({\n          name: attr[1],\n          value: attr[3] || attr[4] || attr[5]\n        })\n        advance(attr[0].length)\n      }\n      if (end) {\n        advance(end[0].length)\n      }\n      return match\n    }\n    return false // 不是开始标签\n  }\n\n  while (html) {\n    let textEnd = html.indexOf('<')\n\n    if (textEnd === 0) {\n      const startTagMatch = parseStartTag(html)\n      if (startTagMatch) {\n        start(startTagMatch.tagName, startTagMatch.attrs)\n        continue\n      }\n\n      const endTagMatch = html.match(endTag)\n      if (endTagMatch) {\n        end(endTagMatch[1])\n        advance(endTagMatch[0].length)\n        continue\n      }\n    }\n\n    let text\n    if (textEnd > 0) {\n      text = html.substring(0, textEnd)\n    }\n    if (text) {\n      chars(text)\n      advance(text.length)\n    }\n  }\n  return root\n}\n","import { parserHTML } from './parser'\n\nexport function compileToFunction(template) {\n  const root = parserHTML(template)\n}\n","export function isFunction(val) {\n\treturn typeof val === 'function'\n}\n\nexport function isObject(val) {\n\treturn typeof val === 'object' && val !== null;\n}\n","const oldArrayPrototype = Array.prototype\nexport const arrayMethods = Object.create(oldArrayPrototype)\n\nconst methods = ['push', 'shift', 'unshift', 'pop', 'reverse', 'sort', 'splice']\n\nmethods.forEach((method) => {\n  arrayMethods[method] = function (...args) {\n    oldArrayPrototype[method].call(this, ...args)\n    let inserted\n    let ob = this.__ob__ // 根据当前数组获取到observer实例\n    switch (method) {\n      case 'push':\n      case 'unshift':\n\t\t\t\tconsole.log('push, unshift')\n        inserted = args\n        break\n      case 'splice':\n        inserted = args.slice(2)\n      default:\n        breakwwww\n    }\n\n    if (inserted) ob.observeArray(inserted)\n  }\n})\n","import { isObject } from '../utils'\nimport { arrayMethods } from './arrary'\n\nclass Observer {\n  constructor(data) {\n    Object.defineProperty(data, '__ob__', {\n      value: this,\n      enumerable: false // 不可枚举的\n    })\n    // data.__ob__ = this\n    if (Array.isArray(data)) {\n      data.__proto__ = arrayMethods\n      this.observeArray(data)\n    } else {\n      this.walk(data)\n    }\n  }\n  observeArray(data) {\n    data.forEach((item) => observe(data))\n  }\n  walk(data) {\n    Object.keys(data).forEach((key) => {\n      defineReactive(data, key, data[key])\n    })\n  }\n}\n\nfunction defineReactive(data, key, value) {\n  observe(value)\n  Object.defineProperty(data, key, {\n    get() {\n      return value\n    },\n    set(newV) {\n      console.log('set', data, key, value)\n      observe(newV)\n      value = newV\n    }\n  })\n}\n\nexport function observe(data) {\n  if (!isObject(data)) {\n    return\n  }\n  if (data.__ob__) {\n    return\n  }\n  return new Observer(data)\n}\n","import { observe } from './observer'\nimport { isFunction } from './utils'\n\nexport function initState(vm) {\n  const opts = vm.$options\n  if (opts.data) {\n    initData(vm)\n  }\n  \n  if (vm.$options.el) {\n    vm.$mount(vm.$options.el)\n  }\n}\n\nfunction initData(vm) {\n  let data = vm.$options.data\n\n  data = vm._data = isFunction(data) ? data.call(vm) : data\n\n  for (let key in data) {\n    proxy(vm,'_data', key) // 会把vm.xxx => vm._data.xxx\n  }\n\n  observe(data)\n}\n\nfunction proxy(vm, source, key) {\n  Object.defineProperty(vm, key, {\n    get() {\n      return vm[source][key]\n    },\n    set(newValue) {\n      vm[source][key] = newValue\n    }\n  })\n}\n","import { compileToFunction } from './compiler'\nimport { initState } from './state'\n\nexport function initMixin(Vue) {\n  Vue.prototype._init = function (options) {\n    const vm = this\n    vm.$options = options\n    initState(vm)\n  }\n\n  Vue.prototype.$mount = function (el) {\n    const vm = this\n    const options = vm.$options\n    el = document.querySelector(el)\n    vm.$el = el\n    if (!options.render) {\n      let template = options.template\n      if (!template && el) {\n        template = el.outerHTML\n        let render = compileToFunction(template)\n        options.render = render\n      }\n    }\n  }\n}\n","import { initMixin } from './init';\n\nfunction Vue(options) {\n\tthis._init(options);\n}\n\ninitMixin(Vue);\n\nexport default Vue;"],"names":["ncname","qnameCapture","startTagOpen","RegExp","endTag","attribute","startTagClose","root","start","tagName","attributes","console","log","end","chars","text","parserHTML","html","advance","len","substring","parseStartTag","match","attrs","length","attr","push","name","value","textEnd","indexOf","startTagMatch","endTagMatch","compileToFunction","template","isFunction","val","isObject","oldArrayPrototype","Array","prototype","arrayMethods","Object","create","methods","forEach","method","args","call","inserted","ob","__ob__","slice","breakwwww","observeArray","Observer","data","defineProperty","enumerable","isArray","__proto__","walk","item","observe","keys","key","defineReactive","get","set","newV","initState","vm","opts","$options","initData","el","$mount","_data","proxy","source","newValue","initMixin","Vue","_init","options","document","querySelector","$el","render","outerHTML"],"mappings":"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"}